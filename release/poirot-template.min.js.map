{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","lib/poirot-template.js"],"names":[],"mappings":"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","file":"poirot-template.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\n\nvar TYPES = {\n  FUNCTION: 'F',\n  ESCAPED: '',\n  LITERAL: 'L',\n  NUMERAL: 'N'\n};\n\n/**\n * @param {string} html\n * @param {object} bindings\n * @returns {function(this:Template)}\n * @constructor\n */\nvar TemplateModule;\nmodule.exports = TemplateModule = function(html, bindings) {\n  return Template.prototype.render.bind(new Template(html, bindings));\n};\n\n/**\n * Delegate to document.createElement(). Replace to substitute\n * another element creation method, e.g. to use jsdom in Node.\n *\n * @param {string} nodeName\n * @returns {HTMLElement}\n */\nvar createElement = function(nodeName) {\n  // jshint browser: true\n  return document.createElement(nodeName);\n};\n\nvar createTextNode = function(text) {\n  // jshint browser: true\n  return document.createTextNode(text);\n};\n\n/**\n * Provide a function to create HTMLElements.\n * @param {Document} doc\n */\nTemplateModule.setDocument = function(doc) {\n  createElement = doc.createElement.bind(doc);\n  createTextNode = doc.createTextNode.bind(doc);\n};\n\nTemplateModule.TYPE = TYPES;\nTemplateModule.DOM_NODE_ID = 'data-tpl-id';\n\nvar renderFunctions = {};\n\n/**\n * @param {string} code\n * @param {function} handler\n * @returns {TemplateModule} Returns the module object for chaining\n */\nTemplateModule.registerHandler = function(code, handler) {\n  if (renderFunctions[code] !== undefined) {\n    throw 'A handler for template code '+code+' already exists';\n  }\n  renderFunctions[code] = handler;\n  return this;\n};\n\n/**\n * @param {string} code\n * @returns {function}\n */\nTemplateModule.getHandler = function(code) {\n  return renderFunctions[code];\n};\n\n\n\nTemplateModule.registerHandler(TYPES.FUNCTION,\n  function(target, value, isAttr) {\n    if (isAttr) {\n      target.value = value;\n    } else {\n      renderFunctions[TYPES.ESCAPED](target, value(), false);\n    }\n  });\n\nTemplateModule.registerHandler(TYPES.ESCAPED, function(target, value, isAttr) {\n   if (isAttr) {\n    target.value = value;\n  } else {\n    if (target.childNodes.length === 0) {\n      target.appendChild(createTextNode(value));\n    } else {\n      target.firstChild.nodeValue = value;\n    }\n  }\n});\n\nTemplateModule.registerHandler(TYPES.LITERAL, function(target, value, isAttr) {\n  if (isAttr) {\n    target.value = value;\n  } else {\n    target.innerHTML = value;\n  }\n});\n\nTemplateModule.registerHandler(TYPES.NUMERAL, function(target, value, isAttr) {\n  var v = isNaN(value) ? 'NaN' : value;\n  if (isAttr) {\n    target.value = v;\n  } else {\n    target.innerHTML = v;\n  }\n});\n\n\n/**\n * @param {object[]} bindingDefs\n * @param {string} html\n * @constructor\n */\nfunction Template(bindingDefs, html) {\n  this.elements = {};\n  this.bindings = {};\n\n  var div = createElement('div');\n  div.innerHTML = html;\n  this.root = div.firstChild;\n\n  var subKey, id, defn, el\n    , elements = div.querySelectorAll(TemplateModule.ID_SELECTOR)\n    , bindingDefsById = {};\n\n  for (var key in bindingDefs) { // jshint ignore:line\n    defn = bindingDefs[key];\n    defn.key = key;\n    subKey = defn.at || '';\n    if (bindingDefsById[defn.id] === undefined) {\n      bindingDefsById[defn.id] = {};\n    }\n    bindingDefsById[defn.id][subKey] = defn;\n  }\n\n  for (var i = elements.length-1; i >= 0; i--) {\n    el = elements[i];\n    id = el.getAttribute(TemplateModule.DOM_NODE_ID);\n    el.removeAttribute(TemplateModule.DOM_NODE_ID);\n    if (id in bindingDefsById) {\n      for (subKey in bindingDefsById[id]) { // jshint ignore:line\n        defn = bindingDefsById[id][subKey];\n        this.bindings[defn.key] = defn;\n        defn.target = defn.at === undefined ? el : el.getAttributeNode(defn.at);\n        defn.render = renderFunctions[defn.tp];\n      }\n    }\n  }\n}\nTemplateModule.ID_SELECTOR = '[' + TemplateModule.DOM_NODE_ID + ']';\nTemplateModule.Template = Template;\n\nvar CLEAR = Template.CLEAR = {};\n\n/**\n * @param {object} values\n * @returns {HTMLElement}\n */\nTemplate.prototype.render = function(values) {\n  var key, value, defn, res, target;\n  for (key in values) {         // jshint ignore:line\n    defn = this.bindings[key];  // jshint ignore:line\n    if (defn !== undefined) {\n      value = values[key];      // jshint ignore:line\n      target = defn.target;\n      try {\n        if (value !== CLEAR) {\n          defn.render(target, value, defn.at);\n        }\n      } catch (e) {\n        console.error('Failed to render value:', value);\n        console.error(e);\n        console.trace();\n        res = '#ERROR';\n      }\n    }\n  }\n\n  return this.root;\n};\n\n\nmodule.exports = TemplateModule;\n"],"sourceRoot":"/source/"}